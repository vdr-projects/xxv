<!-- tlist -->
<?% USE date %?>
<?% enableform = allow('tdelete') || allow('ttoggle');
	rest = param.capacity;
%?>

<?% IF data.size <= 1 %?>
<h1><?% gettext("Planned recordings") %?></h1>
<?% ELSE %?>
<h1><?% gettext("Planned recordings") %?> - <?% date.format(data.1.9, "%A, %x", locale) %?></h1>
<?% END %?>

<?% IF allow('tnew') %?>
<a href="?cmd=tnew">[<?% gettext("Create new timer") %?>]</a>
<?% END %?>
<?% IF allow('tupdate') %?>
<a href="javascript:tostatus('?cmd=tupdate')">[<?% gettext("Update timers") %?>]</a>
<?% END %?>
<form name='Timer'>
<?% INCLUDE 'widgets/referer.tmpl' %?>

<?% IF allow('ttoggle') %?>
<a href="#" onClick="Toggle('<?% gettext("Nothing selected!") %?>',document.TimerList)">
    [<?% gettext("Toggle timer") %?>]
</a>
<?% END %?>
<?% IF allow('tdelete') %?>
<a href="#" onClick="Delete('<?% gettext("Would You like to delete the following timer(s)?") %?>',
'<?% gettext("Nothing selected!") %?>','tdelete',document.TimerList)">
    [<?% gettext("Delete timer") %?>]
</a>
&nbsp;
<?% END %?>
	    <?% gettext("Search for timers") %?>:
        <input type="hidden" name="cmd" value='tsearch' >
        <input type="text" name="data" size='18' <?% IF cgi.param('cmd')=='ts' || cgi.param('cmd')=='tsearch' %?>value='<?% cgi.param('data')%?>'<?% END %?>>
</form>
<?% IF enableform %?>
<form name='TimerList'>
    <?% INCLUDE 'widgets/referer.tmpl' %?>
<?% END %?>
<table border="0" width="95%">
        <tr>
        <?% fields = data.shift %?>
        <?% FOREACH field = fields %?>
            <?% NEXT IF field.match('^__') %?>
            <th><?% field %?></th>
        <?% END %?>
<?% IF enableform %?>
            <th><?% gettext("Selection") %?></th>
<?% END %?>
        </tr>
        <?% FOREACH zeile = data %?>
            <?% aktiv= ( zeile.1 ? zeile.1 mod 2 : 0 );
                vps= ( zeile.1 ? zeile.1 mod 8 div 4 : 0 );
                day = date.format(zeile.9, "%A, %x", locale);
                IF aktiv; rest = rest - zeile.13; END;
            %?>
            <?% IF oldDay != day %?>
            <tr><td colspan='<?% zeile.size + 1 %?>' bgcolor='#DDDDDD'><b><?% day %?></b></td><tr>
            <?% END %?>
            <?% myclass = "normal" %?>
            <?% UNLESS aktiv %?>
                <?% myclass = "deactive" %?>
            <?% ELSIF zeile.10 %?>
                <?% myclass = 'problem' %?>
            <?% ELSIF param.runningTimer.exists(zeile.0) %?>
                <?% myclass = "active" %?>
            <?% END %?>
            <tr class="<?% myclass %?>" <?% IF (loop.count mod 2) == 0 %?>bgcolor='#F5F5F5'<?% END %?>>
                <?% c = -1 %?>
                <?% FOREACH field = zeile %?>
                    <?% c = c + 1 %?>
                    <?% NEXT IF fields.$c.match('^__') %?>
                    <?% IF c == 0; # Id Field %?>
                    <td nowrap><nobr>
                        <a href="?cmd=search&amp;data=<?% url( zeile.7.split('~').last ) %?>" title="<?% gettext("Search for repeats") %?>"><div class="<?% myclass %?>">[R]</div></a>
    <?% IF allow('tedit') %?>
                        <a href="?cmd=tedit&amp;data=<?% zeile.0 %?>" title="<?% gettext("Edit this timer") %?>"><div class="<?% myclass %?>">[E]</div></a>
    <?% END %?>
    <?% IF allow('tdelete') %?>
                        <a href="javascript:sure(document.TimerList, '<?% gettext("Would You like to delete the following timer(s)?") %?> : <?% escape(zeile.7.split('~').first)  %?>','?cmd=tdelete&amp;data=<?% zeile.0 %?>')" title="<?% gettext("Would You like to delete the following timer(s)?") %?>"><div class="<?% myclass %?>">[D]</div></a>
    <?% END %?>
                    </td>
                    <?% ELSIF c == 1; # Id Status %?>
                    <td>
                        <?% aus = gettext('Off') %?>
                        <?% an = gettext('On') %?>
    <?% IF allow('ttoggle') %?>
            			<a name='<?% zeile.0 %?>' href="javascript:tostatus('?cmd=ttoggle&amp;data=<?% zeile.0 %?>', <?% zeile.0 %?>)" title="<?% gettext("Toggle timer") %?>&nbsp;<?% aktiv ? aus : an %?>"><div class="<?% myclass %?>">[<?% aktiv ? an : aus %?>]</div></a>
            			<?% vps ? '(VPS)' : '' %?>
                        <?% IF zeile.12 && allow('aedit') %?>
            			<a href="?cmd=aedit&amp;data=<?% zeile.12 %?>" title="<?% gettext("Edit autotimer") %?>"><div class="<?% myclass %?>">(AT)</div></a><br>
                        <?% END %?>
                        <?% IF rest <= 0 %?><a href="javascript:alert('<?% gettext("Not enough space to record this timer!") %?>')">(!)</a><br/><?% END %?>
    <?% ELSE %?>
            			[<?% aktiv ? aus : an %?>]<?% vps ? '&nbsp;(VPS)' : '' %?>
    <?% END %?>

                        <?% level = getModule('SHARE').getEventLevel(zeile.11) %?>
                        <?% IF level %?><?% "*" FILTER repeat(level) %?><?% END %?>
    		</td>
                    <?% ELSIF c == 2; # Channel Field %?>
                    <td nowrap>
                        <a href="?cmd=program&amp;data=<?% zeile.3 %?>" title="<?% gettext("Jump to program:") %?> <?% field %?>"><div class="<?% myclass %?>"><?% field %?></div></a>
                    </td>
                    <?% ELSIF c == 7; # Title %?>
                    <td>
                        <?% IF zeile.11 %?><?% INCLUDE bloecke/tooltip.tmpl cmd="display" title=field desc=zeile.14 eventid=zeile.11 linkid=zeile.11 ttp_offset=0 %?><?% END %?>
                        <?% FOREACH f = field.split('~') %?>
                            <div class="<?% myclass %?>"><?% f %?></div>
                        <?% END %?>
                        <?% IF zeile.11 %?></a><?% END %?>
                    </td>
                    <?% ELSIF c == 8; # Prio %?>
                    <td>
                        <?% IF myclass == 'fastproblem' %?>
                        <div class="fastproblemgreen"><?% field %?></div>
                        <?% ELSIF myclass == 'problem' %?>
                        <div class="problemred"><?% field %?></div>
                        <?% ELSE %?>
                        <?% field %?>
                        <?% END %?>
                    </td>
                    <?% ELSE %?>
                    <td><?% field %?></td>
                    <?% END %?>
                <?% END %?>
    <?% IF enableform %?>
                    <td>
                        <input type="checkbox" value="<?% zeile.0 %?>" name="<?% zeile.7 | replace('~',' ') %?>" />
                    </td>
    <?% END %?>
            </tr>
            <?% oldDay = day %?>
        <?% END %?>
</table>
<?% IF enableform %?>
</form>
<a href="#" onClick="selAll(document.TimerList, 1)">[<?% gettext("Select all") %?>]</a>
<a href="#" onClick="selAll(document.TimerList, 0)">[<?% gettext("Unselect all") %?>]</a>
<a href="#" onClick="reverse(document.TimerList)">[<?% gettext("Reverse select") %?>]</a>
<?% END %?>
