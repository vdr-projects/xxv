<body class="frame">
<?% USE date %?>
<?% enableform = allow('rdelete') %?>
<?% IF cgi.param('cmd')=='rl' || cgi.param('cmd')=='rlist' %?>
    <?% browse = cgi.param('data') %?>
<?% END %?>
<div id="body">
<?% BLOCK time %?>
<?% date.format(t,"%x %H:%M",locale) %?>
<?% END %?>

<?% BLOCK dur # d in Sekunden %?>
<?% IF d > 1 %?>
    <?% Stunden = d div 3600 %?>
    <?% Minuten = d div 60 mod 60 %?>
    <?% Sekunden =  d mod 60 %?>
    <?% Stunden | format('%d') %?>:<?% Minuten | format('%02d') %?>:<?% Sekunden | format('%02d') %?>
<?% END %?>
<?% END %?>

<?% BLOCK image %?>
    <?% files = param.getPreview(id) %?>
    <?% IF type == 'RADIO' %?>
	<img src="images/radio.png" width="200" title="<?% gettext('Radio recording') %?>" />
    <?% ELSE %?>
	<img src="<?% files.last || "images/movie.png" %?>" width="200" title="<?% gettext('Television recording') %?>" />
    <?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% total = 0 %?>
<?% BLOCK printsumme %?>
                <p class="description" style="padding: 0; margin-left: <?% width %?>px;">
        		<?% IF total > 0;
                    sec  = total mod 60;
                    min  = total div 60 mod 60;
                    hour = total div 3600;
        		%?>
						<?% gettext("total time") %?> : 
						<?% IF hour > 0 %?><?% hour FILTER format('%02d') %?>:<?% END %?><?% min FILTER format('%02d') %?>:<?% sec FILTER format('%02d')%?>
       			<?% END %?>
       		    <?% IF param.free;
                        secf  = param.free mod 60;
                        minf  = param.free div 60 mod 60;
                        hourf = param.free div 3600;
      		    %?>
    					<br /><?% gettext("available capacity") %?> : 
						<?% IF hourf > 0 %?><?% hourf FILTER format('%02d') %?>:<?% END %?><?% minf FILTER format('%02d') %?>:<?% secf FILTER format('%02d')%?>
   			    <?% END %?>
				</p>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK item %?>
      <td valign="top">
        <table cellspacing="0" cellpadding="0" width="1">
          <?% IF folder > 1 %?>
          <tr>
            <td>
                  <a href="?cmd=rlist&amp;data=<?% url( fulltitle ) %?>">
                  <b><?% foldertitle %?></b><br />
                  <?% IF new %?>
                  <img src="images/newfolder.png" alt="" title="<?% gettext("New recording") %?>" />
                  <?% ELSE %?>
                  <img src="images/foldericon.png" alt="" />
                  <?% END %?>
		          &nbsp;<?% folder %?><?% IF new %?>&nbsp;(<?% new %?>)<?% END %?>&nbsp;<?% gettext("more recordings") %?>&nbsp;...
                  </a>
                  <img src="images/blank.png" height="1" width="200" alt="" />
            </td>
          </tr>
          <tr>
            <td>
            <?% IF enableform %?>
            <input type="checkbox" value="all:<?% id %?>" name="<?% gettext("All recordings with title") %?> : '<?% title %?>'" />
            <?% END %?>
            </td>
          </tr>
          <?% ELSE %?>
          <tr>
            <td>
                  <div style="height:160px; vertical-align:middle;">
                  <a href="?cmd=rdisplay&amp;data=<?% id %?>">
                  <?% PROCESS image %?>
                  </a>
                  </div>
                  <div style="height:3em; overflow:hidden;">
                  <?% INCLUDE bloecke/tooltip.tmpl cmd="rdisplay" linkid=id ttp_offset=0 %?>
                  <?% IF new %?><img src="images/new.png" alt="" title="<?% gettext("New recording") %?>" /><?% END %?>
                  <b><?% (title.match('[a-z]') ? title : fulltitle) %?></b>
                  <?% IF subtitle %?>
                  <br>&nbsp;<?% subtitle %?>
                  <?% END %?>
                  </a>
                  </div>
				  </a>
            </td>
          </tr>
          <tr>
            <td>
    <?% IF enableform %?>
                    <input type="checkbox" value="<?% id %?>" name="<?% title %?>" />
    <?% END %?>
                    <?% PROCESS time t=start %?><br />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?% gettext("Duration") %?>: <?% PROCESS dur d=duration %?>
            </td>
          </tr>
          <?% END %?>
        </table>
      </td>

<?% END %?>
<?% IF cgi.param('data') != "" %?>
    <?% search = cgi.param('data') %?>
<?% END %?>
<h1><?% gettext("Stored recordings") %?>
    <?% IF search.defined %?> : "<?% search %?>" <?% END %?>
    &nbsp;<small>(<?% param.usage %?>)</small>
</h1>
<?% IF data.size %?>
<?% fields = data.shift %?>
<form>
        <a href="?cmd=rupdate">[<?% gettext("Update recordings") %?>]</a>&nbsp;
<?% IF allow('rdelete') %?>
<a href="#" onClick="Delete('<?% gettext("Do you want to delete the following recordings?") %?>',
'<?% gettext("Nothing selected!") %?>','rdelete',document.rlist)">
[<?% gettext("Delete recordings") %?>]</a>&nbsp;
<?% END %?>
		<?% gettext("Search for recordings") %?>:
        <input type="hidden" name="cmd" value='rsearch' >
        <input type="text" name="data" size='18' <?% IF cgi.param('cmd')=='rs' || cgi.param('cmd')=='rsearch' %?>value='<?% cgi.param('data')%?>'<?% END %?>>
</form>

<?% IF browse.defined && browse != "" %?>
    <?% directorys = browse.split('~') %?>
    <?% IF directorys.size <= 1 %?>
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist">[^]</a>
    <?% ELSE %?>
    <?% t = directorys.pop %?>
    <?% directory = directorys.join('~') %?>
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist">[^]</a>&nbsp;
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist&amp;data=<?% url( directory ) %?>">[<<]</a>
    <?% END %?>
    <br />
<?% END %?>
<?% IF param.sortable %?>
    <?% cmd = cgi.param('cmd') %?>
    <?% IF cgi.param('data') %?>
        <?% daten = url ( cgi.param('data') ) %?>
        <?% daten = "&amp;data=${daten}" %?>
    <?% END %?>
<?% END %?>
<?% IF enableform %?>
<form name='rlist'>
<?% END %?>
<?% IF param.previewcommand == 'n' %?>
    <table border="0" width="95%">
        <tr>
        <?% c = -1 %?>
        <?% FOREACH field = fields %?>
            <?% c = c + 1 %?>
            <?% NEXT IF field.match('^__') %?>
            <th style="white-space: nowrap">
            <?% field %?>
            <?% IF param.sortable %?>
                <?% IF c == 0 %?>
                  <a href="?cmd=<?% cmd %?><?% daten %?>&__sortby=__RecordStart&__desc=0"><img src="images/asc.png"></a>
                  <a href="?cmd=<?% cmd %?><?% daten %?>&__sortby=__RecordStart&__desc=1"><img src="images/desc.png"></a>
                <?% ELSE %?>
                  <a href="?cmd=<?% cmd %?><?% daten %?>&__sortby=<?% field %?>&__desc=0"><img src="images/asc.png"></a>
                  <a href="?cmd=<?% cmd %?><?% daten %?>&__sortby=<?% field %?>&__desc=1"><img src="images/desc.png"></a>
              <?% END %?>
            <?% END %?>
            </th>
        <?% END %?>
        </tr>
        <?% FOREACH zeile = data %?>
        <?%- id=zeile.0;eventid=zeile.1;title=zeile.2.split('~').last;subtitle=zeile.3;
             duration=zeile.4;start=zeile.5;new=zeile.6;type=zeile.7;folder=zeile.8;fulltitle=zeile.9;
             isrecording=zeile.10;desc=zeile.11;foldertitle=fulltitle.split('~').last -%?>
	    <?% total = total + duration %?>
        <tr>
            <?% IF folder > 1 %?>
            <td colspan="4">
                  <a href="?cmd=rlist&amp;data=<?% url( fulltitle ) %?>">
                  <?% IF new %?>
                  <img src="images/newfolder.png" alt="" title="<?% gettext("New recording") %?>" />
                  <?% ELSE %?>
                  <img src="images/foldericon.png" alt="" />
                  <?% END %?>
                  <b><?% foldertitle.split('~').last %?></b>&nbsp;<?% folder %?><?% IF new %?>&nbsp;(<?% new %?>)<?% END %?>&nbsp;<?% gettext("more recordings") %?>&nbsp;...
                  </a>
            </td>
            <?% ELSE %?>
            <?% c = -1 %?>
            <?% FOREACH field = zeile %?>
             <?%- id=zeile.0;eventid=zeile.1;title=zeile.2.split('~').last;subtitle=zeile.3;
                   duration=zeile.4;start=zeile.5;new=zeile.6;type=zeile.7;folder=zeile.8;fulltitle=zeile.9;
                   isrecording=zeile.10;desc=zeile.11;foldertitle=fulltitle.split('~').last -%?>
                <?% c = c + 1 %?>
                <?% NEXT IF fields.$c.match('^__') %?>
            <td>
                <?% IF c == 0 %?>
    <?% IF enableform %?>
                    <input type="checkbox" value="<?% id %?>" name="<?% title %?>" />
    <?% END %?>
                    <?% PROCESS time t=start %?>
                <?% ELSIF c == 4 %?>
                    <?% PROCESS dur d=field %?>
                <?% ELSIF c == 2 # title %?>
                    <?% INCLUDE bloecke/tooltip.tmpl cmd="rdisplay" linkid=id ttp_offset=0 %?>
                    <?% IF new %?><img src="images/new.png" alt="" title="<?% gettext("New recording") %?>" />&nbsp;<?% END %?>
                    <?% var = (field.split('~').last.match('[a-z]') ? field.split('~').last : zeile.9);chop(var,30) %?>
                    </a>
                <?% ELSE %?>
                    <a href="?cmd=rdisplay&amp;data=<?% id %?>">
                    <?% field %?>
                    </a>
                <?% END %?>
            </td>
            <?% END %?>
            <?% END %?>
        </tr>
        <?% END %?>
	    <tr>
            <td colspan="4">
				<?% PROCESS printsumme width=0 %?>
            </td>
        </tr>
    </table>
<?% ELSE %?>
<?% IF param.sortable %?>
<?% BLOCK SortItem %?>
<a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=0" ><img src="images/asc.png"></a>
<?% label %?>
<a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=1" ><img src="images/desc.png"></a>&nbsp;
<?% END %?>
        <?% gettext('Sorting') %?> :
        <?% PROCESS SortItem row="RecordId" label=gettext('Index') %?>
        <?% PROCESS SortItem row="title" label=gettext('Title') %?>
        <?% PROCESS SortItem row="subtitle" label=gettext('Subtitle') %?>
        <?% PROCESS SortItem row="__RecordStart" label=gettext('Start') %?>
        <?% PROCESS SortItem row="duration" label=gettext('Duration') %?>
<?% END %?>
      <div>
        <?% FOREACH zeile = data %?>
            <!-- Item: <?% FOREACH x = zeile %?><?% loop.count - 1 %?>:<?% x %?>|<?% END %?> -->
            <?%- id=zeile.0;eventid=zeile.1;title=zeile.2.split('~').last;subtitle=zeile.3;
             duration=zeile.4;start=zeile.5;new=zeile.6;type=zeile.7;folder=zeile.8;fulltitle=zeile.9;
             isrecording=zeile.10;desc=zeile.11;foldertitle=fulltitle.split('~').last -%?>
		    <?% total = total + duration %?>
			<?% IF old.defined && old != ( folder > 1 ?  2 : 1 ) %?>
      <div style="clear:both"></div>
        <?% END %?>
      <div style="float:left; margin: 2px">
            <?% PROCESS item %?>
            <?% old = ( folder > 1 ?  2 : 1 ) %?>
      </div>
        <?% END %?>
    </div>
    <div style="clear:both"></div>
	<?% PROCESS printsumme width=0 %?>
    <?% END %?>
<?% IF enableform %?>
</form>
<a href="#" onClick="selAll(document.rlist, 1)">[<?% gettext("Select all") %?>]</a>
<a href="#" onClick="selAll(document.rlist, 0)">[<?% gettext("Unselect all") %?>]</a>
<a href="#" onClick="reverse(document.rlist)">[<?% gettext("Reverse select") %?>]</a>
<?% END %?>

<?% END %?>
