<!-- rlist -->
<div id="body">
<?% USE date %?>
<?% ######################################################################## %?>
<?% enableform = allow('rdelete') && data.size > 1  %?>
<?% IF cgi.param('cmd')=='rl' || cgi.param('cmd')=='rlist' %?>
    <?% browse = cgi.param('data') %?>
<?% END %?>
<?% ######################################################################## %?>
<?% IF param.sortable.defined %?>
    <?% IF cgi.param('__sortby') %?>
        <?% sortby = cgi.param('__sortby') %?>
        <?% sortby = "&amp;__sortby=${sortby}" %?>
        <?% orderby = cgi.param('__desc') %?>
        <?% orderby = "${sortby}&amp;__desc=${orderby}" %?>
    <?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK time %?>
<?% date.format(t,"%x",locale) %?>&nbsp;<?% date.format(t,"%H:%M",locale) %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK durMin # d in Minuten%?>
<?% IF d > 1 %?>
    <?% Stunden = d div 60 %?>
    <?% Minuten = d mod 60 %?>
    <?% Sekunden = ( d * 60 ) mod 60 %?>
    <br />Dauer: <?% Stunden div 1 %?>:<?% Minuten | format('%02d') %?>:<?% Sekunden | format('%02d') %?> 
<?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK dur # d in Sekunden %?>
<?% IF d > 1 %?>
    <?% Stunden = d div 3600 %?>
    <?% Minuten = d div 60 mod 60 %?>
    <?% Sekunden =  d mod 60 %?>
    <br />Dauer: <?% Stunden div 1 %?>:<?% Minuten | format('%02d') %?>:<?% Sekunden | format('%02d') %?> 
<?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% total = 0 %?>
<?% BLOCK printsumme %?>
    <tr>
        <?% IF enableform %?>
        <td></td>
        <?% END %?>
		<?% IF param.previewcommand != 'n' %?>
        <td></td>
        <?% END %?>
        <td></td>
        <td class="description" style="padding: 0;">
        		<?% IF total > 0;
                    sec  = total mod 60;
                    min  = total div 60 mod 60;
                    hour = total div 3600;
        		%?>
						<?% gettext("total time") %?> : 
						<?% IF hour > 0 %?><?% hour FILTER format('%02d') %?>:<?% END %?><?% min FILTER format('%02d') %?>:<?% sec FILTER format('%02d')%?>
       			<?% END %?>
       		    <?% IF param.free;
                        secf  = param.free mod 60;
                        minf  = param.free div 60 mod 60;
                        hourf = param.free div 3600;
      		    %?>
    					<br /><?% gettext("available capacity") %?> : 
						<?% IF hourf > 0 %?><?% hourf FILTER format('%02d') %?>:<?% END %?><?% minf FILTER format('%02d') %?>:<?% secf FILTER format('%02d')%?>
   			    <?% END %?>
		</td>
        <td></td>
    </tr>

<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK image %?>
	<?%- files = param.getPreview(id);
         IF type == 'RADIO';
            mylist = [ "images/audio", global.imagetyp ];
            preview = mylist.join('.') ;
         ELSIF files.size > 0;
#
#           USE date;
#           img = date.format(date.now, '%S') mod files.size;
#           preview = files.$img;
# 
            img = (files.size div 2);
            preview = files.$img;
         END;
         IF preview.length <= 0;
            mylist = [ "images/movie", global.imagetyp ];
            preview = mylist.join('.') ;
         END;
    -%?>
	<img class="recording" src="<?% preview %?>" alt="" />
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK RowButtons %?>
    <?% INCLUDE widgets/tooltip.inc cmd="rdisplay" linkid=id ttp_offset=-400 %?>
    <?% IF global.playbackmode == 0 %?>
        <?% IF allow('stream') %?>
            <a href="?cmd=stream&amp;data=<?% id %?>">
                <img src="images/play.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording") %?>" />
            </a>
        <?% END %?>
    <?% ELSIF global.playbackmode == 1 %?>
        <?% IF allow('playrecord') %?>
            <a href="?cmd=playrecord&amp;data=<?% id %?>">
                <img src="images/play.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording") %?>" />
            </a>
        <?% END %?>
    <?% ELSIF global.playbackmode == 2 %?>
        <?% IF allow('rplay') %?>
            <a href="?cmd=rplay&amp;data=<?% id %?>">
                <img src="images/play.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording") %?>" />
            </a>
        <?% END %?>
    <?% END %?>
    <?% IF allow('rdelete') %?>
            <a href="javascript:sure('<?% gettext("Do you really want to delete these recordings?") %?> : \'<?% escape( title ) %?>\' ?','?cmd=rdelete&amp;data=<?% id %?>')">
                <img src="images/delete.<?% global.imagetyp %?>" alt="" title="<?% gettext("Delete recording") %?>" />
            </a>
    <?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK item %?>
        <?% IF folder > 1 %?>
            <?% IF enableform %?>
        <td>
            <input type="checkbox" value="all:<?% id %?>" name="<?% gettext("All recordings with title") %?> : '<?% foldertitle %?>'" />
        </td>
             <?% END %?>
		<?% IF param.previewcommand != 'n' %?>
        <td></td>
		<?% END %?>
        <td>
            <a href="?cmd=rlist&amp;data=<?% url( fulltitle ) %?><?% orderby %?>">
        <?% IF new %?>
            <img src="images/newfolder.<?% global.imagetyp %?>" alt="" title="<?% gettext("New recording") %?>" />            
        <?% ELSE %?>
            <img src="images/folder.<?% global.imagetyp %?>" alt="" />
        <?% END %?>     
                &nbsp;<font class="title"><?% foldertitle %?></font>
                <font class="subtitle">&nbsp;-&nbsp;
                        <?% folder %?><?% IF new %?>&nbsp;(<?% new %?>)<?% END %?>&nbsp;<?% gettext("more recordings") %?> ...
                      </font>
            </a>
        </td>
        <td></td>
        <td></td>
        <?% ELSE %?>
            <?% IF enableform %?>
        <td>
        		<input type="checkbox" value="<?% id %?>" name="<?% title %?><?% IF subtitle.length > 0 %?> - <?% subtitle ;END %?>" />
        </td>
             <?% END %?>
		<?% IF param.previewcommand != 'n' %?>
        <td>
            <a href="?cmd=rdisplay&amp;data=<?% id %?>" title="<?% title %?>">
		      <?% PROCESS image %?>
            </a>
        </td>
		<?% END %?>
        <td>
            <a href="?cmd=rdisplay&amp;data=<?% id %?>" title="<?% title %?>">
            <?% IF new %?><img src="images/new.<?% global.imagetyp %?>" alt="" title="<?% gettext("New recording") %?>" />&nbsp;<?% END %?>            
            <font class="title"><?% title %?></font>
            <?% IF subtitle.length > 0 && folder <= 1%?>
                <br /><font class="subtitle"><?% subtitle %?></font>
            <?% END %?>
            <?% IF global.hideDescription != 1 && description.length > 0 %?>
                <br /><font class="description"><?% chop(description,100,3) %?></font>
            <?% END %?>
            </a>
        </td>
        <td>
            <a href="?cmd=rdisplay&amp;data=<?% id %?>" title="<?% title %?>">
            <?% PROCESS time t=start%?>&nbsp;<?% PROCESS dur d=duration %?>
            </a>
        </td>
        <td>
            <?% PROCESS RowButtons %?>
        </td>
   <?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% IF cgi.param('data') != "" %?>
    <?% search = cgi.param('data') %?>
<?% END %?>
<h1>
    <?% gettext("Stored recordings") %?>
    <?% IF search.defined %?> : "<?% search %?>" 
    <?% END %?>
    &nbsp;<small>(<?% param.usage %?>)</small>
</h1>
<?% IF data.size > 1 %?>
<form name="rlist" action="">
<?% fields = data.shift %?>
<table summary="" width="100%">
    <tr>
        <?% IF enableform %?>
        <th width="16"></th>
        <?% END %?>
		<?% IF param.previewcommand != 'n' %?>
        <th width="72"></th>
        <?% END %?>
        <th></th>
        <th width="100"></th>
        <th width="60" align="right"></th>
    </tr>
    <?% FOREACH zeile = data %?>
    <?% IF debug;"<!-- Item: ";FOREACH x = zeile;loop.count - 1;":";x.replace("-"," ");"|";END;"-->";END %?>
    <tr<?% " class='two'" IF loop.count mod 2 == 0 %?>>
    <?%- id=zeile.0;
          eventid=zeile.1;
          title=zeile.2.split('&#x7e;').last;
          IF title == " ";  title=zeile.2.split('&#x7e;').last(2).join(" "); END;
          subtitle=zeile.3;
          duration=zeile.4;
          start=zeile.5;
          new=zeile.6;
          type=zeile.7;
          folder=zeile.8;
          fulltitle=zeile.9;
          isrecording=zeile.10;
          description=zeile.11;
          foldertitle=fulltitle.split('&#x7e;').last;
          IF foldertitle == " ";  foldertitle=fulltitle.split('&#x7e;').last(2).join(" "); END;
          PROCESS item;
          total = total + duration; -%?>
    </tr>
    <?% END %?>
	<?% PROCESS printsumme %?>
</table>
</form>
<?% END %?>
</div>
<!-- ###### Seite ###### -->
<div id="sidebar">
<?% IF (browse != "") || allow('rupdate') %?>
  <p class="section"><?% gettext("Recordings",20) %?></p>
    <p>
<?% IF browse == "" %?>
<?% IF allow('rupdate') %?>
      <a href="?cmd=rupdate"><img src="images/refresh.<?% global.imagetyp %?>" alt="Aktualisieren" title="Aktualisieren" /></a>&nbsp;
      <a href="?cmd=rupdate"><?% gettext("Update recordings",20) %?></a>
<?% END %?>
<?% IF allow('rrecover') %?>
      <a title="<?% gettext("Recover deleted recordings") %?>" href="?cmd=rrecover"><img src="images/recover.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a title="<?% gettext("Recover deleted recordings") %?>" href="?cmd=rrecover"><?% gettext("Recover deleted recordings",20) %?></a>
<?% END %?>
<?% ELSE %?>
    <?% directorys = browse.split('~') %?>
    <?% IF directorys.size <= 1 %?>
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist<?% orderby %?>"><img src="images/folder.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist<?% orderby %?>"><?% gettext("Back",20) %?></a>
    <?% ELSE %?>
    <?% t = directorys.pop %?>
    <?% directory = directorys.join('~') %?>
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist&amp;data=<?% url( directory ) %?><?% orderby %?>"><img src="images/folder.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist&amp;data=<?% url( directory ) %?><?% orderby %?>"><?% gettext("Back",20) %?></a>
    <?% END %?>
<?% END %?>
    </p>
<?% END %?>
<?% IF param.sortable.defined %?>
    <?% cmd = cgi.param('cmd') %?>
    <?% IF cgi.param('data') %?>
        <?% daten = url( cgi.param('data') ) %?>
        <?% daten = "&amp;data=${daten}" %?>
    <?% END %?>
    <p class="section"><?% gettext("Sorting",20) %?></p>
        <table summary="">
<?% BLOCK SortItem %?>
        <tr>
            <td style="padding:0px;" width="20"><a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=0" ><img src="images/home.<?% global.imagetyp %?>" alt="" /></a></td>
            <td style="padding:0px;" width="160">
                <?% "<b>" IF cgi.param('__sortby') == row %?>
                <a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=<?% IF cgi.param('__sortby') == row && cgi.param('__desc') == 0 %?>1<?% ELSE %?>0<?% END %?>" >
                <?% label %?>
                </a>
                <?% "</b>" IF cgi.param('__sortby') == row %?>
            </td>
            <td style="padding:0px;" width="20"><a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=1" ><img src="images/down.<?% global.imagetyp %?>" alt="" /></a></td>
        </tr>
<?% END %?>
        <?% PROCESS SortItem row=fields.0 label=gettext('Index',20) %?>
        <?% PROCESS SortItem row=fields.2 label=gettext('Title',20) %?>
        <?% PROCESS SortItem row=fields.3 label=gettext('Subtitle',20) %?>
        <?% PROCESS SortItem row=fields.5 label=gettext('Start',20) %?>
        <?% PROCESS SortItem row=fields.4 label=gettext('Duration',20) %?>
      </table>
<?% END %?>
<?% IF enableform %?>
    <p class="section"><?% gettext("Selection",20) %?></p>
    <p>
      <a href="javascript:selAll(document.rlist,1)"><img src="images/select.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a href="javascript:selAll(document.rlist,1)"><?% gettext("Select all",20) %?></a><br />
      <a href="javascript:selAll(document.rlist,0)"><img src="images/deselect.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a href="javascript:selAll(document.rlist,0)"><?% gettext("Unselect all",20) %?></a><br />
      <a href="javascript:reverse(document.rlist)"><img src="images/invers.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a href="javascript:reverse(document.rlist)"><?% gettext("Reverse select",20) %?></a><br />
<?% IF allow('rdelete') %?>
        <a href="javascript:DeleteSelected('<?% gettext("Do you want to delete the following recordings?") %?>','<?% gettext("Nothing selected!") %?>','rdelete',document.rlist)"><img src="images/delete.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
        <a href="javascript:DeleteSelected('<?% gettext("Do you want to delete the following recordings?") %?>','<?% gettext("Nothing selected!") %?>','rdelete',document.rlist)"><?% gettext("Delete recordings",20) %?></a><br />
<?% END %?>
    </p>
<?% END %?>
  <p class="section"><?% gettext("Search for recordings",20) %?></p>
  <form action=""> 
    <p>
        <input type="hidden" name="cmd" value="rsearch" />
        <input type="text" name="data" size="18" <?% IF search.defined %?>value="<?% search %?>"<?% END %?> />
    </p>
  </form>
</div>
<?% global.sidebar = 1 %?>
