<!-- rdisplay -->
<?% USE date %?>
<?% title = data.Title %?>
<?% subtitle = data.SubTitle %?>
<?% id = data.RecordId %?>
<?% allowplay = 1 IF allow('rplay') or allow('playrecord') %?>
<?% IF ! global.bodyinc.defined;global.bodyinc = 1 %?>

<?% files = data.preview.split(',') %?>
<script language="javascript" type="text/javascript">
<!--
  var pics = <?% files.size %?>;
  if( pics > 3) {
  	window.onload = initslide;
  }
  function setstart(wert) {
    document.forms.offset.__start.value = wert;
  }  
  function playstart(cmd) {
    var url = '?cmd='+cmd + '&data=<?% id %?>&__start=' + document.forms.offset.__start.value;
    location.href = url;
  }
-->
</script>
<body class="hilfsframed">
<div>
<?% END %?>

<?% ######################################################################## %?>
<?% BLOCK hfs # d in Sekunden %?>
  <?% d div 3600 %?>:<?% d div 60 mod 60 | format('%02d') %?>:<?% d mod 60 | format('%02d') %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK dur # d in Sekunden %?>
    <br /><?% gettext("Duration") %?>: <?% PROCESS hfs %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK image %?>
  <?% IF data.Type == 'RADIO' %?>
    <img class="recorddetails" src="images/audio.<?% global.imagetyp %?>" alt="" title="<?% gettext('Radio recording') %?>" />
  <?% ELSIF files.size > 0; %?>
	<div id="slideframe">
        <?% IF files.size > 3 %?>
		<div id="slideleft"><img src="images/back.<?% global.imagetyp %?>" title="<?% gettext("Back") %?>" alt="" /></div>
		<div id="slideright"><img src="images/forward.<?% global.imagetyp %?>" title="<?% gettext("Next") %?>" alt="" /></div>
        <?% END %?>
		<div id="slidelist" style="left:<?% IF files.size <= 3 %?><?% 280 - (160 * ( files.size / 2 ) )  %?><?% ELSE %?>0<?% END %?>px; width:<?% files.size * 200 %?>px;" >
        <?% FOREACH frame = files %?>
          <?% d = ( frame ) / 25 %?>
          <?% IF allowplay %?><a href="javascript:setstart('<?% PROCESS hfs %?>')" ><?% END %?>
          <img src="?cmd=ri&data=<?% data.RecordId %?>_<?% frame %?>" alt="" title="<?% PROCESS hfs %?>" />
          <?% IF allowplay %?></a><?% END %?>
				<?% END %?>
			<div id="slideend"></div>
		</div>
	</div>
  <?% ELSE %?>
    <img class="recorddetails" src="images/movie.<?% global.imagetyp %?>" alt="" title="<?% gettext('Television recording') %?>" />
  <?% END; %?>
<?% END %?>

<?% quest=data.Title;IF data.SubTitle.length > 0;quest=data.SubTitle;END %?>
<?% ######################################################################## %?>
<?% BLOCK RowButtons %?>
<form name="offset" method="get" action="">
<div align="right" style="white-space: nowrap">
    <a target="_blank" href="http://german.imdb.com/find?s=tt&amp;site=aka&amp;q=<?% quest %?>">
        <img src="images/imdb.<?% global.imagetyp %?>" title="<?% gettext("Search with IMDb") %?>" alt="IMDb" />
    </a>
    <a target="_blank" href="http://www.ofdb.de/view.php?page=suchergebnis&Kat=Titel&SText=<?% quest %?>">
        <img src="images/ofdb.<?% global.imagetyp %?>" title="<?% gettext("Search with OFDb") %?>" alt="OFDb" />
    </a>
    <?% IF allow('rcut') %?>
            <a href="?cmd=rcut&amp;data=<?% id %?>">
                <img src="images/cut.<?% global.imagetyp %?>" alt="" title="<?% gettext("Cut recording") %?>" />
            </a>
    <?% END %?>
    <?% IF allow('redit') %?>
            <a href="?cmd=redit&amp;data=<?% id %?>">
                <img src="images/edit.<?% global.imagetyp %?>" alt="" title="<?% gettext("Edit recording") %?>" />
            </a>
    <?% END %?>
    <?% IF allow('rdelete') %?>
            <a href="javascript:sure('<?% gettext("Would you like to delete this recording?") %?>','<?% escape(title) %?><?% IF subtitle.length > 0 %?>~<?% escape(subtitle) %?><?% END %?>','rdelete','<?% id %?>')">
                <img src="images/delete.<?% global.imagetyp %?>" alt="" title="<?% gettext("Delete recording") %?>" />
            </a>
    <?% END %?>
    &nbsp;
    <?% IF allow('rplay') %?>
        <a href="javascript:playstart('rplay')" >
            <img src="images/watch.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording in VDR") %?>" />
        </a>
    <?% END %?>
    <?% IF allow('playrecord') %?>
        <a href="javascript:playstart('playrecord')" >
            <img src="images/webcast.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording as web cast") %?>" />
        </a>
    <?% END %?>
    <?% IF allowplay %?>
        <input type="hidden" name="cmd" value="<?% IF global.preferedlocal && allow('rplay') %?>rplay<?% ELSE %?>playrecord<?% END %?>" />
        <input type="hidden" name="data" value="<?% id %?>" />
        <input style="width:60px;" size="10"  type="text" name="__start" value="00:00:00.0" />
    <?% END %?>
</div>
</form>
<?% END %?>
<?% ######################################################################## %?>
<?% ######################################################################## %?>
<?% BLOCK marks %?>
<?% width = 550 %?>
  <table summary="" style="width:<?% width %?>px; margin:0; padding:0; text-align:left" >
    <tr>
        <?%- 
             multi=1;
             IF data.Duration;
               window = 900;
               ticks = 0;
               WHILE (ticks <= 3 or ticks >= 8) && window > 15;
                 ticks = (data.Duration div window) + 1;
                 IF ticks >= 8;
                   window = window * 2; 
                 ELSIF ticks <= 3;
                   IF    window == 900;window = 600;
                   ELSIF window == 600;window = 300;
                   ELSIF window == 300;window = 150;
                   ELSIF window == 150;window = 60;
                   ELSE; window = window / 2; 
                   END;
                 END;
               END;
             END;
             
             IF window <= 300;
              multi=60;
             END;
             IF window <= 15 or ticks < 1;
              ticks = 1;
              window = 15;
             END;
             cols = 0; 
             WHILE cols < ticks; 
                cols = cols + 1; 
                seconds = window * cols; -%?>

         <td colspan="3" style="width:<?% ( ( width / ticks) ) div 1 %?>px; white-space: nowrap; text-align:right">
            <font size='0.66em'>
<?% IF allowplay && seconds < data.Duration %?><a href="javascript:setstart('<?% PROCESS hfs d=seconds %?>')" ><?% END %?>
                <?% ( seconds * multi ) div 3600 %?>:<?% ( seconds * multi ) div 60 mod 60 | format('%02d') %?>
<?% IF allowplay && seconds < data.Duration %?></a><?% END %?>
            </font>
        </td>
<?% END %?>
    </tr>
    <tr>
        <?%- cols = 0; 
             window = window div 3;
             WHILE cols < ( ticks * 3); 
                cols = cols + 1; 
                seconds = window * cols; -%?>
         <td style="width:<?% (width / (ticks * 3)) div 1 %?>px; white-space: nowrap; text-align:right">
            <img style="background:<?% cols % 3 ? "gray" : "black" %?>" src="images/blank.gif" width="<?% cols % 12 ? "1" : "2" %?>" height='<?% (cols % 3 ? "5" : "10") %?>' />
        </td>
<?% END %?>
    </tr>
    <tr>
        <td colspan="<?% cols %?>" style="white-space: nowrap">
		<?%- secold = 0;
	        c = -1;
	        ml = data.Marks.split(',');
          totaltime = ticks * window * 3;
		      IF ml.size > 1;
		FOREACH marker = ml;
                b = c;
                c = c + 1;
                m = marker.split(':');
                sec = m.0 * 3600;
                sec = sec + m.1 * 60;
                sec = sec + m.2;
                percent = ((sec-secold) / totaltime) * width;
            -%?><?% IF c == 0 %?>
					<?% class = "marksleft" %?>
				<?% ELSE %?>
					<?% class = (class == 'marksright2' ? 'marksright1' : 'marksright2'); %?>
	        	<?% END %?><img<?% IF allowplay %?> onclick="javascript:setstart('<?% PROCESS hfs d=secold %?>')"<?% END %?> class="<?% class %?>" src="images/blank.gif" width="<?% ( percent ) div 1 %?>" height="12" title="<?% (b < 0 ? "0:00:00.00" : ml.$b) %?> - <?% ml.$c %?>" />
            <?%- secold = sec;
            END;
            IF totaltime > secold;
            class = (class == 'marksright2' ? 'marksright1' : 'marksright2'); 
            percent = ((data.Duration - secold) / totaltime) * width;
            -%?><img<?% IF allowplay %?> onclick="javascript:setstart('<?% PROCESS hfs d=secold %?>')"<?% END %?> class="<?% class %?>" src="images/blank.gif" width="<?% ( percent ) div 1 %?>" height="12" title="<?% (c < 0 ? "0:00:00.00" : ml.$c) %?> - <?% PROCESS hfs d=data.Duration %?>" />
            <?% END %?>
        <?% ELSE %?>
			      <img class="marksleft" src="images/blank.gif" width="0" height="12" /><img class="marksright2" src="images/blank.gif" width="<?% (( data.Duration / totaltime) * width ) div 1 %?>" height="12" />
        <?% END %?>
        </td>
    </tr>
  </table>
<?% END %?>
<?% ######################################################################## %?>
<table class="editortable" summary="">
	<tr>
		<td class="editorhead title">
        <div class="editorhead" style="float:left;">
          <?% IF data.New %?><img src="images/new.<?% global.imagetyp %?>" alt="" title="<?% gettext("New recording") %?>" /><?% END %?>            
          <font class="title"><?% title %?></font>
          <?% IF subtitle.length > 0 %?><font class="subtitle">&nbsp;~&nbsp;<?% subtitle %?></font><?% END %?>
        </div>
        <?% INCLUDE shutter.inc %?>
		</td>
	</tr>
	<tr>
		<td class="editortext">
			<table width="100%" summary="" >
				<tr>
					<td valign="top" align="center">
          <?% PROCESS image %?>
					</td>
				</tr>
				<tr>
					<td>
						<table width="100%" summary="" >
							<tr>
								<td>
			          <?% date.format(data.StartTime,"%A, %x",locale) %?>&nbsp;
                &nbsp;&nbsp;&nbsp;<?% date.format(data.StartTime,"%H:%M",locale) %?>&nbsp;-&nbsp;<?% date.format(data.StopTime,"%H:%M",locale) %?>
                <?% PROCESS dur d=data.Duration %?>
                <?% IF data.Channel %?>
								<br /><?% gettext('Channel') %?> : <?% data.Channel %?>
								<?% END %?>
								</td>
								<td class="push">
									<?% IF allow('rconvert') && param.reccmds.size > 0 %?>
									<p>
									<form action="">
										<select name='data' onchange="di('?cmd=rconvert&amp;data=',this.form.data.options[this.form.data.options.selectedIndex].value)"> 
											<option value='0'><?% gettext("Choose a command to edit this recording ...") %?></option>
											<?% FOREACH cmd = param.reccmds %?>
											<option value='<?% loop.count %?>_<?% id %?>'><?% cmd.split(':').first %?></option>
											<?% END %?>
										</select>
									</form>
									</p>
									<?% END %?>
								</td>
							</tr>
							<tr>
								<td colspan="2">
                                    <p>
<?% data.Description %?>
                                    </p>
								</td>
							</tr>
							<tr>
								<td colspan="2">
						            <?% PROCESS marks %?>
					            </td>
							</tr>
                            <tr>
                                <td>
                                <?% gettext('Lifetime') %?>&nbsp;:&nbsp;<?% data.Lifetime %?>,&nbsp;
                                <?% gettext('Priority') %?>&nbsp;:&nbsp;<?% data.Prio %?>
                                </td>
                                <td class="push">
                                <?% PROCESS RowButtons %?>
                                </td>
                            </tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td class="editorbottom"></td>
	</tr>
</table>
