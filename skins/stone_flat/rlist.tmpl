<!-- rlist -->
<body class="frame">
<?% USE date %?>
<?% ######################################################################## %?>
<div id="body">
<?% ######################################################################## %?>
<?% enableform = allow('rdelete') && data.size > 1  %?>
<?% IF cgi.param('cmd')=='rl' || cgi.param('cmd')=='rlist' %?>
    <?% browse = cgi.param('data') %?>
<?% END %?>
<?% ######################################################################## %?>
<?% IF param.sortable.defined %?>
    <?% IF cgi.param('__sortby') %?>
        <?% sortby = cgi.param('__sortby') %?>
        <?% sortby = "&amp;__sortby=${sortby}" %?>
        <?% orderby = cgi.param('__desc') %?>
        <?% orderby = "${sortby}&amp;__desc=${orderby}" %?>
    <?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK time %?>
<?% date.format(t,"%x",locale) %?>
<br />
<?% date.format(t,"%H:%M",locale) %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK dur # d in Sekunden %?>
<?% IF d > 1 %?>
    <?% Stunden = d div 3600 %?>
    <?% Minuten = d div 60 mod 60 %?>
    <?% Sekunden =  d mod 60 %?>
    <?% Stunden %?>:<?% Minuten | format('%02d') %?>:<?% Sekunden | format('%02d') %?> 
<?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% total = 0 %?>
<?% BLOCK printsumme %?>
<p class="description" style="padding: 0; margin-left: <?% width %?>px;">
<?% IF total > 0;
    sec  = total mod 60;
    min  = total div 60 mod 60;
    hour = total div 3600;
%?>
<?% gettext("total time") %?> : 
<?% IF hour > 0 %?><?% hour FILTER format('%02d') %?>:<?% END %?><?% min FILTER format('%02d') %?>:<?% sec FILTER format('%02d')%?>
<?% END %?>
<?% IF param.free;
        secf  = param.free mod 60;
        minf  = param.free div 60 mod 60;
        hourf = param.free div 3600;
%?>
<br /><?% gettext("available capacity") %?> : 
<?% IF hourf > 0 %?><?% hourf FILTER format('%02d') %?>:<?% END %?><?% minf FILTER format('%02d') %?>:<?% secf FILTER format('%02d')%?>
<?% END %?>
</p>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK image %?>
	<?%- files = param.getPreview(eventid);
         IF type == 'RADIO';
            mylist = [ "images/audio", global.imagetyp ];
            preview = mylist.join('.') ;
         ELSIF files.size > 0;
#
#           USE date;
#           img = date.format(date.now, '%S') mod files.size;
#           preview = files.$img;
# 
            img = (files.size div 2);
            preview = files.$img;
         END;
         IF preview.length <= 0;
            mylist = [ "images/movie", global.imagetyp ];
            preview = mylist.join('.') ;
         END;
    -%?>
	<img class="recording" src="<?% preview %?>" alt="" />
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK RowButtons %?>
    <?% IF global.playbackmode == 0 %?>
        <?% IF allow('stream') %?>
            <a href="javascript:popup('stream','<?% id %?>',620,670,1)">
                <img src="images/play.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording") %?>" />
            </a>
        <?% END %?>
    <?% ELSIF global.playbackmode == 1 %?>
        <?% IF allow('playrecord') %?>
            <a href="?cmd=playrecord&amp;data=<?% id %?>">
                <img src="images/play.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording") %?>" />
            </a>
        <?% END %?>
    <?% ELSIF global.playbackmode == 2 %?>
        <?% IF allow('rplay') %?>
            <a href="javascript:popup('rplay','<?% id %?>',620,670,1)">
                <img src="images/play.<?% global.imagetyp %?>" alt="" title="<?% gettext("Watch recording") %?>" />
            </a>
        <?% END %?>
    <?% END %?>
    <?% IF allow('redit') %?>
            <a href="javascript:popup('redit','<?% id %?>',620,670,1)">
                <img src="images/edit.<?% global.imagetyp %?>" alt="" title="<?% gettext("Edit recording") %?>" />
            </a>
    <?% END %?>
    <?% IF allow('rdelete') %?>
            <a href="javascript:surecmd('<?% gettext("You will delete this recording") %?>','<?% escape(fulltitle) %?>','rdelete','<?% id %?>',620,670)">
                <img src="images/delete.<?% global.imagetyp %?>" alt="" title="<?% gettext("Delete recording") %?>" />
            </a>
    <?% END %?>
<?% END %?>
<?% ######################################################################## %?>
<?% BLOCK ItemAsFlat %?>
        <tr<?% ' class="two"' IF loop.count mod 2 == 0 %?>>
          <td class="fieldinline">
          <?% IF folder > 1 %?>
              <?% IF enableform %?>
              <input type="checkbox" value="all:<?% id %?>" name="<?% gettext("All recordings with title") %?> : '<?% foldertitle %?>'" />
              <?% END %?>
          <?% ELSE %?>
            <?% IF enableform %?>
        			<input class="push" type="checkbox" value="<?% id %?>" name="<?% fulltitle %?>" />
             <?% END %?>
		  <?% IF param.previewcommand != 'n' %?>
            <a href="javascript:popup('rdisplay','<?% id %?>',620,670,0)" class="fieldinline">
              <?% PROCESS image %?>
            </a>
		  <?% END %?>
		  <?% END %?>
          </td>
          <td class="fieldinline">
            <?% IF folder <= 1 %?>
            <a href="javascript:popup('rdisplay','<?% id %?>',620,670,0)" class="fieldinline">
              <?% IF new %?><img src="images/new.<?% global.imagetyp %?>" alt="" title="<?% gettext("New recording") %?>" />&nbsp;<?% END %?>
              <font class="title">
                <?% title %?>
              </font>
     		    <?% ELSE %?>
            <a href="?cmd=rlist&amp;data=<?% url( fulltitle ) %?><?% orderby %?>" class="fieldinline title">
              <?% IF new %?>
                  <img src="images/newfolder.<?% global.imagetyp %?>" alt="" title="<?% gettext("New recording") %?>" />            
              <?% ELSE %?>
                  <img src="images/folder.<?% global.imagetyp %?>" alt="" />
              <?% END %?>
                <font class="title">
                <?% foldertitle %?>
                </font>
  		    <?% END %?>
                <br />
                <font class="subtitle">
          <?% IF folder <= 1 %?>
                  <?% subtitle %?>
                  <?% IF global.hideDescription != 1 && description.length > 0 %?><br />
                      </font><font class="description"><?% chop(description,100,5) %?><?% END %?>
  		    <?% ELSE %?>
                    <?% folder %?><?% IF new %?>&nbsp;(<?% new %?>)<?% END %?>&nbsp;<?% gettext("more recordings") %?> ...
  		    <?% END %?>
                </font>
            </a>
            </td>
            <td class="fieldinline push">
                <?% IF folder <= 1 %?>
                <a href="javascript:popup('rdisplay','<?% id %?>',620,670,0)" class="fieldinline description">
                    <?% PROCESS time t=start %?>
                    <br />
                    <br />
                    <?% PROCESS dur d=duration %?>
                </a>
                <br />
                <?% INCLUDE widgets/tooltip.inc cmd="rdisplay" linkid=id ttp_offset=-300 %?>
                <?% PROCESS RowButtons %?>
      		    <?% END %?>
            </td>
        </tr>
<?% END %?>
<?% ######################################################################## %?>
<?% IF cgi.param('data') != "" %?>
    <?% search = cgi.param('data') %?>
<?% END %?>
<h1>
    <?% gettext("Stored recordings") %?>
    <?% IF search.defined %?> : "<?% search %?>"<?% END %?> 
    &nbsp;<small>(<?% param.usage %?>)</small>
</h1>
<?% IF data.size > 1 %?>
<?% fields = data.shift %?>
<form name="rlist" action="">
            <table class="largetable" summary="">
                <tr><td class="largehead"><?% IF search.defined %?><?% search %?><?% END %?></td></tr>
                    <tr>
                        <td class="largetext" align="left">
                        <table  summary="" width="100%">
                        <tr height="0"><th width="<?% IF param.previewcommand != 'n' %?>200<?% ELSE %?>20<?% END %?>"></th><th></th><th width="64"></th></tr>
     <?%- FOREACH zeile = data;
          IF debug;"<!-- Item: ";FOREACH x = zeile;loop.count - 1;":";x.replace("-"," ");"|";END;"-->";END;
          id=zeile.0;
          eventid=zeile.1;
          title=zeile.2.split('&#x7e;').last;
          IF title == " ";  title=zeile.2.split('&#x7e;').last(2).join(" "); END;
          subtitle=zeile.3;
          duration=zeile.4;
          start=zeile.5;
          new=zeile.6;
          type=zeile.7;
          folder=zeile.8;
          fulltitle=zeile.9;
          isrecording=zeile.10;
          description=zeile.11;
          foldertitle=fulltitle.split('&#x7e;').last;
          IF foldertitle == " ";  foldertitle=fulltitle.split('&#x7e;').last(2).join(" "); END;
          PROCESS ItemAsFlat;
  		    total = total + duration;
        END; -%?>
                        </table>
                        </td>
                    </tr>
                <tr><td class="largebottom"></td></tr>
            </table> 
<?% PROCESS printsumme width=780 %?>
</form>
<?% END %?>
</div>
<!-- ###### Seite ###### -->
<div id="sidebar">
<?% IF allow('rupdate') || browse != "" %?>
  <table summary="">
    <tr><td class="sidehead"><?% gettext("Recordings",20) %?></td></tr>
<?% IF browse == "" %?>
<?% IF allow('rupdate') %?>
    <tr>
    <td class="sidetext">
      <a title="<?% gettext("Update recordings") %?>" href="javascript:popupcmd('rupdate',620,670,1)"><img src="images/refresh.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a title="<?% gettext("Update recordings") %?>" href="javascript:popupcmd('rupdate',620,670,1)"><?% gettext("Update recordings",20) %?></a>
    </td>
    </tr>
<?% END %?>
<?% ELSE %?>
    <tr>
    <td class="sidetext">
    <?% directorys = browse.split('~') %?>
    <?% IF directorys.size <= 1 %?>
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist<?% orderby %?>"><img src="images/folder.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist<?% orderby %?>"><?% gettext("Back",20) %?></a>
    <?% ELSE %?>
    <?% t = directorys.pop %?>
    <?% directory = directorys.join('~') %?>
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist&amp;data=<?% url( directory ) %?><?% orderby %?>"><img src="images/folder.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
      <a title="<?% gettext("Back") %?>" href="?cmd=rlist&amp;data=<?% url( directory ) %?><?% orderby %?>"><?% gettext("Back",20) %?></a>
    <?% END %?>
    </td>
    </tr>
<?% END %?>
    <tr>
    <td class="sidebottom"></td>
    </tr>
  </table>
<?% END %?>
<?% IF param.sortable.defined %?>
    <?% cmd = cgi.param('cmd') %?>
        <?% IF cgi.param('data') %?>
            <?% daten = url( cgi.param('data') ) %?>
            <?% daten = "&amp;data=${daten}" %?>
        <?% END %?>
  <table summary="">
    <tr><td class="sidehead"><?% gettext("Sorting",20) %?></td></tr>
    <tr>
    <td class="sidetext">
<?% BLOCK SortItem %?>
        <ul>
            <li><a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=0" ><img src="images/home.<?% global.imagetyp %?>" alt="" /></a></li>
            <li class="label">
                <?% "<strong>" IF cgi.param('__sortby') == row %?>
                <a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=<?% IF cgi.param('__sortby') == row && cgi.param('__desc') == 0 %?>1<?% ELSE %?>0<?% END %?>" >
                <?% label %?>
                </a>
                <?% "</strong>" IF cgi.param('__sortby') == row %?>
            </li>
            <li><a href="?cmd=<?% cmd %?><?% daten %?>&amp;__sortby=<?% row %?>&amp;__desc=1" ><img src="images/down.<?% global.imagetyp %?>" alt="" /></a></li>
        </ul>
<?% END %?>
        <?% PROCESS SortItem row=fields.0 label=gettext('Index',20) %?>
        <?% PROCESS SortItem row=fields.2 label=gettext('Title',20) %?>
        <?% PROCESS SortItem row=fields.3 label=gettext('Subtitle',20) %?>
        <?% PROCESS SortItem row=fields.5 label=gettext('Start',20) %?>
        <?% PROCESS SortItem row=fields.4 label=gettext('Duration',20) %?>
    </td>
    </tr>
    <tr>
    <td class="sidebottom"></td>
    </tr>
  </table>
<?% END %?>
<?% IF enableform %?>
  <table summary="">
    <tr><td class="sidehead"><?% gettext("Select",20) %?></td></tr>
    <tr>
    <td class="sidetext">
        <a href="javascript:selAll(document.rlist,1)"><img src="images/select.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
        <a href="javascript:selAll(document.rlist,1)"><?% gettext("Select all",20) %?></a><br />
        <a href="javascript:selAll(document.rlist,0)"><img src="images/deselect.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
        <a href="javascript:selAll(document.rlist,0)"><?% gettext("Unselect all",20) %?></a><br />
        <a href="javascript:reverse(document.rlist)"><img src="images/invers.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
        <a href="javascript:reverse(document.rlist)"><?% gettext("Reverse select",20) %?></a>
    </td>
    </tr>
    <tr>
    <td class="sidetext">
<?% IF allow('rdelete') %?>
        <a href="javascript:DeleteSelected('<?% gettext("You would delete follow recordings?") %?>','<?% gettext("You have nothing selected!") %?>','rdelete',document.rlist,620,670)"><img src="images/delete.<?% global.imagetyp %?>" alt="" /></a>&nbsp;
        <a href="javascript:DeleteSelected('<?% gettext("You would delete follow recordings?") %?>','<?% gettext("You have nothing selected!") %?>','rdelete',document.rlist,620,670)"><?% gettext("Delete recordings",20) %?></a><br />
<?% END %?>
    </td>
    </tr>
    <tr>
    <td class="sidebottom"></td>
    </tr>
  </table>
<?% END %?>
  <table summary="">
    <tr><td class="sidehead"><?% gettext("Search for recordings",20) %?></td></tr>
    <tr>
    <td class="sidetext">
    <form name="searchform" action="">
        <input type="hidden" name="cmd" value="rsearch" />
        <input type="text" id="rectext" name="data" alt="<?% gettext("Search") %?>" 
               onkeyup="suggest('rsuggest','rectext','recsuggest');" 
               <?% IF search.defined %?>value="<?% search %?>"<?% END %?>
               autocomplete="off" />
        <br /><div class="suggestbox" id="recsuggest"></div>
    </form>
    </td>
    </tr>
    <tr>
        <td class="sidebottom"></td>
    </tr>
  </table>
  <p id="sidefooter">&nbsp;</p>
</div>
<?% INCLUDE header.inc %?>
